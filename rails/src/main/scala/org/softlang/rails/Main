package org.softlang.rails

import com.typesafe.config.ConfigFactory
import java.io.{PrintStream, File}
import megal.{Context, Tool}

class Main {
  def main(args: List[String]) {
    if (args.length < 2) {
      System.out.print("Please provide the following arguments: a config file| a megamodel file")
      System.exit(-1)
    }

    Context.config = ConfigFactory.parseFile(new File(args(0))).withFallback(Context.config)
    ConfigFactory.load

    val input: String = args(1)

    Tool.parse(input)
    Tool.extend()
    Tool.analyze()
    Tool.parse(input)
    Tool.link()
    Tool.check()

    // Write event log back next to input file
    val output: String = input.substring(0, input.lastIndexOf('.')) + ".json"

    val ps: PrintStream = new PrintStream(output)
    ps.println(Tool.getEvents.getJson)
    ps.close()
  }

}